/* 
   jQuery Money Formatter Plugin
   By Eric Arnol-Martin (earnolmartin@gmail.com)
*/
(function($){$.fn.moneyFormat=function(options){var settings=$.extend({decimalCharacter:".",thousandsSeparator:",",precision:2,currencySymbol:"$",round:"normal"},options);var value=0;var baseNum=null;var decNum=null;var diff=null;var formattedBaseNum=null;var unformattedNum=null;var regexSafe=settings.decimalCharacter;regexSafe=regexSafe.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var regex=new RegExp("[^0-9"+regexSafe+"]","g");return this.each(function(){var value=$(this).val();while(value[0]=="0"){value=value.slice(1)}value=removeMoneyFormatting(value,regex,settings.decimalCharacter);unformattedNum=value;if(value!=""){var positionOfDecChar=value.indexOf(settings.decimalCharacter);if(positionOfDecChar!=-1){baseNum=value.substring(0,positionOfDecChar);decNum=value.substring(positionOfDecChar+1);if(decNum.length<settings.precision){diff=settings.precision-decNum.length;decNum=settings.decimalCharacter+decNum;for(var i=0;i<diff;i++){decNum=decNum+"0"}}else{if(decNum.length!=settings.precision){if(settings.round=="roundDown"){if(settings.precision!=0){decNum=settings.decimalCharacter+decNum.substring(0,settings.precision)}else{decNum=""}}else{var roundedNumber=0;var decimalRange=decNum.substring(0,settings.precision);var restOfRange=decNum.substring(settings.precision);if(settings.round=="round"){if(Number(restOfRange[0])>=5){roundedNumber=incrementDecimalRange(decimalRange)}else{roundedNumber=decimalRange}}else{if(settings.round=="roundUp"){if(restOfRange[0]!="0"){roundedNumber=incrementDecimalRange(decimalRange)}else{roundedNumber=decimalRange}}else{roundedNumber=decimalRange}}if(roundedNumber==Math.pow(10,Number(settings.precision))){decNum=settings.precision==0?"":settings.decimalCharacter;for(var i=0;i<settings.precision;i++){decNum=decNum+"0"}baseNum=(Number(baseNum)+1).toString()}else{if(settings.precision!=0){decNum=settings.decimalCharacter+roundedNumber.toString()}else{decNum=""}}}}else{if(settings.precision!=0){decNum=settings.decimalCharacter+decNum}}}}else{decNum=settings.precision==0?"":settings.decimalCharacter;for(var i=0;i<settings.precision;i++){decNum=decNum+"0"}baseNum=value}if(baseNum.length>=4){var count=0;formattedBaseNum="";for(var i=baseNum.length-1;i>=0;i--){if(count%3==0&&count!=0){count=0;formattedBaseNum=baseNum[i]+settings.thousandsSeparator+formattedBaseNum}else{formattedBaseNum=baseNum[i]+formattedBaseNum}count++}}else{formattedBaseNum=baseNum}if(formattedBaseNum==""){formattedBaseNum="0"}$(this).val(settings.currencySymbol+formattedBaseNum+decNum)}else{value="0"+settings.decimalCharacter;for(var i=0;i<settings.precision;i++){value+="0"}$(this).val(settings.currencySymbol+value)}this.moneyUnformat=function(e){$(this).val(removeMoneyFormatting($(this).val(),regex,settings.decimalCharacter))};this.moneyReturnUnformatted=function(e){return removeMoneyFormatting($(this).val(),regex,settings.decimalCharacter)};this.moneyReturnOriginalEntry=function(e){return getOriginalNumber()}});function getOriginalNumber(){return unformattedNum}function removeMoneyFormatting(value,regex,decimalChar){value=value.replace(regex,"");var lastDecInStr=value.lastIndexOf(decimalChar);if(lastDecInStr!=-1){var toLastDec=value.substring(0,lastDecInStr);toLastDec=toLastDec.replace(/[^0-9]/g,"");value=toLastDec+value.substring(lastDecInStr)}return value}function incrementDecimalRange(number){var lengthOfImmediateRange=number.length;number=Number(number)+1;number=number.toString();if(number.length<lengthOfImmediateRange){var diff=lengthOfImmediateRange-number.length;for(var i=0;i<diff;i++){number="0"+number}}return number}}}(jQuery));
